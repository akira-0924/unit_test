# 単体テストの価値を高めるリファクタリング

この章では 6 章で行った、関数型アーキテクチャのリファクタリングによる出力値ベースのテストへの移行を、もっと広い範囲（関数型アーキテクチャを適応できないアプリケーションを含む）に適応するにはどうするか、ということをみていく。

## リファクタリングが必要なコードの識別

全てのプロダクションコードは以下の 2 つの視点で分類できる。

- コードの複雑さ、もしくは、ドメインにおける重要性
- 協力者オブジェクト（可変もしくはプロセス外依存）の数

単体テストを行う価値が最もあるのは、複雑なコード、もしくは、ドメインにおける重要なコードである。（退行に対する保護が備わるため）

この 2 つの観点でコードを分類すると、以下のようになる。

![alt text](<スクリーンショット 2025-01-15 0.56.51.png>)

**ドメインモデル / アルゴリズム**
多くの場合、ドメインモデルには複雑なコードが含まれているが、必ずしも複雑なコードがドメインにおいて重要となるわけではない。

**取るに足らないコード**
引数なしのコンストラクタや 1 行で書かれたプロパティなど。このようなコードが協力者オブジェクトを持つことは滅多になく複雑さもドメインにおける重要性もない。

**コントローラー**
複雑なことやビジネス的に重要なことを行うことはないが、複数のコンポーネントを適切に連携できるように調整を行う。

**過度に複雑なコード**
コードの複雑さやドメインにおける重要性が高く、協力者オブジェクトを多く持つ。例えば、複雑な処理をどこにも移譲せず自身の中で全て行う fat コントローラーなど。
